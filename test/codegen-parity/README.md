# GraphQL Go Gen - Codegen Parity Tests

This directory contains parity tests comparing the output of graphql-go-gen with the original JavaScript GraphQL Code Generator.

## Structure

```
codegen-parity/
├── configs/                 # Plugin-specific test configurations
│   ├── typescript/          # TypeScript base plugin configs
│   ├── typescript-operations/ # TypeScript operations plugin configs
│   ├── add/                 # Add plugin configs (headers/footers)
│   ├── typed-document-node/ # Typed document node plugin configs
│   ├── gql-tag-operations/  # GraphQL tag operations configs
│   ├── fragment-masking/    # Fragment masking configs
│   └── persisted-documents/ # Persisted documents configs
├── generated/               # JS codegen output (gitignored)
├── go-generated/           # Go codegen output (gitignored)
├── parity_test.go          # Go test that runs graphql-go-gen
└── package.json            # NPM dependencies and scripts
```

## Shared Test Data

All configurations use the same test schema and operations located at:
- Schema: `../../pkg/plugins/testdata/schema.graphql`
- Operations: `../../pkg/plugins/testdata/operations.graphql`

This ensures consistency across all plugin tests while allowing each plugin to test its specific configuration options.

## Running Tests

### Prerequisites

```bash
# Install JS dependencies
npm install

# Build the Go binary
npm run build:go
# or manually:
cd ../.. && go build ./cmd/graphql-go-gen
```

### Run All Tests

```bash
# Run Go parity tests
npm run test:parity

# Run JS comparison
npm run compare

# Generate all outputs (JS and Go)
npm run codegen:all
npm run generate:go
```

### Run Tests for Specific Plugin

```bash
# Test specific plugin
npm run test:plugin --plugin=typescript-operations

# Generate for specific plugin
npm run codegen:plugin --plugin=typescript
npm run generate:go:plugin --plugin=typescript
```

## Adding New Plugin Tests

1. Create a new directory under `configs/` with your plugin name
2. Add TypeScript config files for different test scenarios
3. Each config should:
   - Point to the shared schema/operations files
   - Output to `../../generated/<plugin-name>/<config-name>.ts`
   - Include the appropriate plugins and configuration

Example config structure:
```typescript
import type { CodegenConfig } from '@graphql-codegen/cli';

const config: CodegenConfig = {
  schema: '../../../pkg/plugins/testdata/schema.graphql',
  documents: '../../../pkg/plugins/testdata/operations.graphql',
  generates: {
    '../../generated/my-plugin/default.ts': {
      plugins: ['typescript', 'my-plugin'],
      config: {
        // Plugin-specific config
      }
    }
  }
};

export default config;
```

## Test Outputs

- **go-generated/**: Contains output from graphql-go-gen
- **generated/**: Contains output from JS GraphQL Code Generator
- **parity-report.md**: Detailed comparison report (generated by compare.js)

## Clean Up

```bash
# Remove all generated files
npm run clean

# Remove generated files and compiled configs
npm run clean:all
```